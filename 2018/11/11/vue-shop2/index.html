<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="biubiu的博客">
    <meta name="keyword"  content="">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>
        
        demo_vue-shop2 - undefined
        
    </title>

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/aircloud.css">
    <link rel="stylesheet" href="/css/gitment.css">
    <!--<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">-->
    <link href="//at.alicdn.com/t/font_620856_pl6z7sid89qkt9.css" rel="stylesheet" type="text/css">
    <!-- ga & ba script hoook -->
    <script></script>
</head>

<body>

<div class="site-nav-toggle" id="site-nav-toggle">
    <button>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
        <span class="btn-bar"></span>
    </button>
</div>

<div class="index-about">
    <i>  </i>
</div>

<div class="index-container">
    
    <div class="index-left">
        
<div class="nav" id="nav">
    <div class="avatar-name">
        <div class="avatar">
            <img src="/img/avatar.jpg" />
        </div>
        <div class="name">
            <span>biubiu</span>
        </div>
    </div>
    <div class="contents" id="nav-content">
        <ul>
            <li >
                <a href="/">
                    <i class="iconfont icon-shouye1"></i>
                    <span>HOME</span>
                </a>
            </li>
            <li >
                <a href="/tags">
                    <i class="iconfont icon-biaoqian1"></i>
                    <span>TAGS</span>
                </a>
            </li>
            <li >
                <a href="/archives">
                    <i class="iconfont icon-guidang2"></i>
                    <span>ARCHIVES</span>
                </a>
            </li>
            <li >
                <a href="/about/">
                    <i class="iconfont icon-guanyu2"></i>
                    <span>ABOUT</span>
                </a>
            </li>
            
            <li>
                <a id="search">
                    <i class="iconfont icon-sousuo1"></i>
                    <span>SEARCH</span>
                </a>
            </li>
            
        </ul>
    </div>
    
        <div id="toc" class="toc-article">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#vue实战项目外卖2"><span class="toc-text">vue实战项目外卖2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ajax请求"><span class="toc-text">ajax请求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vuex管理状态"><span class="toc-text">vuex管理状态</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-创建Store-核心仓库"><span class="toc-text">11.1 创建Store(核心仓库)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块对象"><span class="toc-text">模块对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#State"><span class="toc-text">State</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mutation"><span class="toc-text">Mutation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Action"><span class="toc-text">Action</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异步获取并显示数据"><span class="toc-text">异步获取并显示数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#完成Msite页面"><span class="toc-text">完成Msite页面</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#异步显示食品分类轮播列表"><span class="toc-text">异步显示食品分类轮播列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用watch与-nextTick解决轮播的Bug"><span class="toc-text">使用watch与$nextTick解决轮播的Bug</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#异步显示商家列表"><span class="toc-text">异步显示商家列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#开发评分Star组件"><span class="toc-text">开发评分Star组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用svg显示页面加载中提示界面"><span class="toc-text">使用svg显示页面加载中提示界面</span></a></li></ol></li></ol></li></ol>
</div>
    
</div>


<div class="search-field" id="search-field">
    <div class="search-container">
        <div class="search-input">
            <span id="esc-search"> <i class="icon-fanhui iconfont"></i></span>
            <input id="search-input"/>
            <span id="begin-search">search</span>
        </div>
        <div class="search-result-container" id="search-result-container">

        </div>
    </div>
</div>
        <div class="index-about-mobile">
            <i>  </i>
        </div>
    </div>
    
    <div class="index-middle">
        <!-- Main Content -->
        


<div class="post-container">
    <div class="post-title">
        demo_vue-shop2
    </div>

    <div class="post-meta">
        <span class="attr">Post：<span>2018-11-11 17:30:09</span></span>
        
        <span class="attr">Tags：/
        
        <a class="tag" href="/tags/#vue" title="vue">vue</a>
        <span>/</span>
        
        
        </span>
        <span class="attr">Visit：<span id="busuanzi_value_page_pv"></span>
</span>
</span>
    </div>
    <div class="post-content no-indent">
        <h1 id="vue实战项目外卖2"><a href="#vue实战项目外卖2" class="headerlink" title="vue实战项目外卖2"></a>vue实战项目外卖2</h1><h2 id="ajax请求"><a href="#ajax请求" class="headerlink" title="ajax请求"></a>ajax请求</h2><p><strong>问题分析：</strong></p>
<ul>
<li>目前为止运行的所有页面都是静态页面</li>
<li>接下来先测试使用封装的ajax接口请求函数来异步获取数据</li>
<li><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 先在App.vue中引入封装的接口函数</span></span><br><span class="line"><span class="keyword">import</span> &#123;reqCategorys&#125; <span class="keyword">from</span> <span class="string">'./api'</span></span><br><span class="line"><span class="comment">// 然后再调用接口，测试打印数据</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="keyword">async</span> mounted () &#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys()</span><br><span class="line">    <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    FooterGuide</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>   报错了，跨域问题。8080的端口在请求4000端口的数据，然后在api文件夹下的index.js中修改测试</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义BASE_URL</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="string">'http://local:4000'</span></span><br><span class="line"><span class="comment">// 然后修改请求接口的url</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCategorys = <span class="function"><span class="params">()</span> =&gt;</span> ajax(BASE_URL + <span class="string">'/index_category'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>跨域是浏览器的限制。解决办法：1.服务器告诉浏览器允许跨域 2.蒙蔽浏览器的双眼</p>
</blockquote>
<p><strong>配置代理并测试接口：</strong></p>
<ul>
<li>除了设置让服务器允许跨域的方法之外，还可以通过配置代理实现跨域请求</li>
</ul>
<ol>
<li><p>在项目config文件夹下的index.js文件里设置代理配置表</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// Paths</span></span><br><span class="line"> <span class="comment">// 静态资源文件夹</span></span><br><span class="line"> assetsSubDirectory: <span class="string">'static'</span>,</span><br><span class="line"> <span class="comment">// 发布路径</span></span><br><span class="line">assetsPublicPath: <span class="string">'/'</span>,</span><br><span class="line"><span class="comment">// 代理配置表，在这里可以配置特定的请求代理到对应的API接口</span></span><br><span class="line"><span class="comment">// 例如将'localhost:8080/api/xxx'代理到'www.example.com/api/xxx'</span></span><br><span class="line">proxyTable: &#123;</span><br><span class="line"> <span class="string">'/api'</span>: &#123; <span class="comment">// 匹配所有以 '/api'开头的请求路径</span></span><br><span class="line">	target: <span class="string">'http://localhost:4000'</span>,</span><br><span class="line">	<span class="comment">// 代理目标的基础路径</span></span><br><span class="line">  <span class="comment">// secure: false,</span></span><br><span class="line">  <span class="comment">// 如果是https接口，需要配置这个参数</span></span><br><span class="line">  changeOrigin: <span class="literal">true</span>, <span class="comment">// 支持跨域</span></span><br><span class="line">  pathRewrite: &#123; <span class="comment">// 重写路径: 去掉路径中开头的'/api'</span></span><br><span class="line">    <span class="string">'^/api'</span>: <span class="string">''</span></span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;,</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改api文件夹index.js里接口函数的请求路径</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const BASE_URL = 'http://local:4000'</span></span><br><span class="line"><span class="keyword">const</span> BASE_URL = <span class="string">'/api'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqAddress = <span class="function"><span class="params">geohash</span> =&gt;</span> ajax(<span class="string">`<span class="subst">$&#123;BASE_URL&#125;</span>/position/<span class="subst">$&#123;geohash&#125;</span>`</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> reqCategorys = <span class="function"><span class="params">()</span> =&gt;</span> ajax(BASE_URL + <span class="string">'/index_category'</span>)</span><br><span class="line"><span class="comment">// 下面修改后的接口省略...</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>因为修改了项目的config文件，所以需要重启项目<code>npm run dev</code></p>
</li>
<li><p>此时可以在控制台看到跨域请求到的数据<code>{code: 0, data: Array(16)}</code></p>
</li>
</ol>
<h2 id="vuex管理状态"><a href="#vuex管理状态" class="headerlink" title="vuex管理状态"></a>vuex管理状态</h2><ul>
<li>安装Vuex<code>npm install vuex --save</code>用来管理从后台获取的状态数据</li>
<li>以下代码以首页Msite为例</li>
</ul>
<h3 id="11-1-创建Store-核心仓库"><a href="#11-1-创建Store-核心仓库" class="headerlink" title="11.1 创建Store(核心仓库)"></a>11.1 创建Store(核心仓库)</h3><ul>
<li><p>在项目的store文件夹下新建index.js</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">vuex最核心的管理对象store</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">// 首先引入Vue及Vuex</span></span><br><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"><span class="comment">// 引入四个基本模块</span></span><br><span class="line"><span class="keyword">import</span> state <span class="keyword">from</span> <span class="string">'./state'</span></span><br><span class="line"><span class="keyword">import</span> mutations <span class="keyword">from</span> <span class="string">'./mutations'</span></span><br><span class="line"><span class="keyword">import</span> actions <span class="keyword">from</span> <span class="string">'./actions'</span></span><br><span class="line"><span class="keyword">import</span> getters <span class="keyword">from</span> <span class="string">'./getters'</span></span><br><span class="line"><span class="comment">// 一定要声明使用插件</span></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"><span class="comment">// 把 store 对象提供给 “store” 选项，这可以把 store 的实例注入所有的子组件</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">state,</span><br><span class="line">mutations,</span><br><span class="line">actions,</span><br><span class="line">getters</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="模块对象"><a href="#模块对象" class="headerlink" title="模块对象"></a>模块对象</h3><ul>
<li>状态对象 state</li>
<li>操作state 直接更新state的多个方法对象 mutations</li>
<li>操作mutations 间接更新state的多个方法对象 actions</li>
<li>包含多个基于state的getter计算属性的对象 getters</li>
<li>包含n个mutations的type名称常量 mutations-type</li>
</ul>
<h4 id="State"><a href="#State" class="headerlink" title="State"></a>State</h4><ul>
<li>分析整理出项目首页Msite中有哪些状态需要管理，然后写入state.js</li>
<li><p>在之前应该定位，这里直接保存当前状态</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">状态对象 state</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> latitude: <span class="number">40.10038</span>, <span class="comment">// 纬度</span></span><br><span class="line"> longitude: <span class="number">116.36867</span>, <span class="comment">// 经度</span></span><br><span class="line"> address: &#123;&#125;, <span class="comment">// 地址相关信息对象</span></span><br><span class="line"> categorys: [], <span class="comment">// 食品分类数组</span></span><br><span class="line">  shops: [] <span class="comment">// 商家数组</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h4><ul>
<li><p>更改 Vuex 的 store 中的状态的唯一方法是提交 mutation</p>
</li>
<li><p>每个 mutation 都有一个字符串的 <strong>事件类型 (type)</strong> 和 一个 <strong>回调函数 (handler)</strong></p>
</li>
<li><p>我们可以使用常量替代 Mutation 事件类型，新建<strong>mutations-types文件</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">包含n个mutation的type名称常量</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_ADDRESS = <span class="string">'receive_address'</span> <span class="comment">// 接收地址信息</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_CATEGORYS = <span class="string">'receive_categorys'</span> <span class="comment">// 接收分类数组</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> RECEIVE_SHOPS = <span class="string">'receive_shops'</span> <span class="comment">// 接收商家数组</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>然后在mutations.js文件内引入使用 <strong>(注意书写格式[ ])</strong></p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">/*</span></span><br><span class="line"><span class="comment">   vuex 的 mutations 模块</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">   <span class="keyword">import</span> &#123;RECEIVE_ADDRESS,RECEIVE_CATEGORYS,RECEIVE_SHOPS&#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">// [方法名](state,&#123;param&#125;)&#123;&#125;</span></span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    [RECEIVE_ADDRESS](state, &#123;address&#125;) &#123;</span><br><span class="line">	state.address = address</span><br><span class="line">&#125;,</span><br><span class="line">[RECEIVE_CATEGORYS](state, &#123;categorys&#125;) &#123;</span><br><span class="line">	state.categorys = categorys</span><br><span class="line">&#125;,</span><br><span class="line">[RECEIVE_SHOPS](state, &#123;shops&#125;) &#123;</span><br><span class="line">	state.shops = shops</span><br><span class="line">&#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>而回调函数就是我们实际进行状态更改的地方，并且它会接受 state 作为第一个参数</p>
</li>
</ul>
<h4 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h4><ul>
<li>和后台交互的异步action，</li>
</ul>
<p>Action 类似于 mutation，不同在于：</p>
<ul>
<li>Action 提交的是 mutation，而不是直接变更状态。</li>
<li><p>Action 可以包含任意异步操作。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// Action:通过操作mutation间接更新state的多个方法的对象</span></span><br><span class="line">  <span class="comment">// 注意要引入api接口函数</span></span><br><span class="line">  <span class="keyword">import</span> &#123;reqAddress, reqCategorys, reqShops&#125; <span class="keyword">from</span> <span class="string">'../api'</span></span><br><span class="line">  <span class="keyword">import</span> &#123;RECEIVE_ADDRESS, RECEIVE_CATEGORYS, RECEIVE_SHOPS&#125; <span class="keyword">from</span> <span class="string">'./mutation-types'</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步获取地址</span></span><br><span class="line">  <span class="keyword">async</span> getAddress (&#123;commit, state&#125;) &#123;</span><br><span class="line">  <span class="comment">// 从state状态中获取到经纬度用来设置reqAddress的参数（看接口文档）</span></span><br><span class="line">  <span class="keyword">const</span> geohash = state.latitude + <span class="string">','</span> + state.longitude</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 1. 发送异步ajax请求</span></span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqAddress(geohash)</span><br><span class="line">  <span class="comment">// 2. 根据结果提交一个mutation</span></span><br><span class="line">  <span class="comment">//因为mutation.js里面的函数接收的参数是&#123;address&#125;</span></span><br><span class="line">  commit(RECEIVE_ADDRESS, &#123;<span class="attr">address</span>: result.data&#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 异步获取分类列表</span></span><br><span class="line"><span class="keyword">async</span> getCategorys (&#123;commit&#125;) &#123;</span><br><span class="line">  <span class="keyword">const</span> result = <span class="keyword">await</span> reqCategorys()</span><br><span class="line">  commit(RECEIVE_CATEGORYS, &#123;<span class="attr">categorys</span>: result.data&#125;)</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 异步获取商家列表</span></span><br><span class="line"><span class="keyword">async</span> getShops (&#123;commit, state&#125;) &#123;</span><br><span class="line">  <span class="comment">// 对象的解构赋值</span></span><br><span class="line">  <span class="keyword">const</span> &#123;latitude, longitude&#125; = state</span><br><span class="line">  <span class="comment">// 注意参数的顺序</span></span><br><span class="line">  <span class="keyword">const</span> result = aowait reqShops(&#123;latitude, longitude&#125;)</span><br><span class="line">  commit(RECEIVE_SHOPS, &#123;<span class="attr">shops</span>: result.data&#125;)</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>至此已经完成了首页状态数据的vuex设置</p>
</li>
</ul>
<h3 id="异步获取并显示数据"><a href="#异步获取并显示数据" class="headerlink" title="异步获取并显示数据"></a>异步获取并显示数据</h3><ol>
<li><p>在项目中注册store</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//项目的main.js文件</span></span><br><span class="line"><span class="keyword">import</span> store <span class="keyword">from</span> <span class="string">'./store'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">	store</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试异步<strong>获取</strong>当前地址数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 地址信息要尽早的获取，所以请求可以写在App.vue中</span></span><br><span class="line"><span class="comment">// 首先删除之前测试使用封装的ajax接口的代码</span></span><br><span class="line"><span class="keyword">async</span> mounted () &#123;</span><br><span class="line">    <span class="comment">// 通过this.$store.dispatch 方法触发调用Action</span></span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'getAddress'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>运行项目，在浏览器控制台里打开vue开发工具，切换到vuex，可以看到通过vuex异步获取的状态数据</li>
<li>除了这种方法调用action，还可以使用mapActions语法糖</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123;mapActions&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> mounted () &#123;</span><br><span class="line">    <span class="keyword">this</span>.getAddress()</span><br><span class="line">&#125;</span><br><span class="line">methods: &#123;</span><br><span class="line">	...mapActions([<span class="string">'getAddress'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>读取</strong>并显示获取到的当前地址数据</p>
<ul>
<li>首页Msite组件中显示地址信息</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 利用mapState语法糖去读取state对象</span></span><br><span class="line"><span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line"></span><br><span class="line">computed: &#123;</span><br><span class="line">	...mapState([<span class="string">'address'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;HeaderTop :title=<span class="string">"address.name"</span>&gt;</span><br><span class="line"><span class="comment">// 将静态地址信息换成异步获取的地址数据 注意:title为绑定数据</span></span><br><span class="line">&lt;<span class="regexp">/HeaderTop&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="完成Msite页面"><a href="#完成Msite页面" class="headerlink" title="完成Msite页面"></a>完成Msite页面</h2><h3 id="异步显示食品分类轮播列表"><a href="#异步显示食品分类轮播列表" class="headerlink" title="异步显示食品分类轮播列表"></a>异步显示食品分类轮播列表</h3><ul>
<li>上面已经完成了首页当前地址信息的获取与显示，接下来是完成Msite.vue中的食品分类的轮播图</li>
</ul>
<ol>
<li><p>mounted方法中通过this.$store.dispatch调用Action来获取异步数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 忘记Actuon里对应的方法名时查看Action.js</span></span><br><span class="line">mounted () &#123;</span><br><span class="line">    <span class="keyword">this</span>.$store.dispatch(<span class="string">'getCategorys'</span>)</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>通过mapState语法糖来读取获取到的异步数据</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 忘记state名时查看State.js</span></span><br><span class="line">computed: &#123;</span><br><span class="line">    ...mapState([<span class="string">'address'</span>, <span class="string">'categorys'</span>])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>分析template结构并处理categorys数据</p>
<p>轮播图应该在数组数据显示之后才能显示</p>
<blockquote>
<p>业务分析： 此时获取到的categorys是所有食品类别的一维数组，而如果要完成轮播图，需要将其变成这种<code>[[page1], [page2], [page3]]</code>二维数组categorysArr。</p>
</blockquote>
<blockquote>
<p>比如本项目中有两页轮播图，一页为8个数据。应该把categorys数组处理成<code>[[data1 - 8], [data1 - 8]]</code>这种数据格式</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//template</span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span> <span class="attr">v-for</span>=<span class="string">"(pages,index) in categorysArr"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:"</span> <span class="attr">class</span>=<span class="string">"(data,index) in pages"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">        ......</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>利用计算属性将categorys处理成期望的数据结构categorysArr</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">computed () &#123;</span><br><span class="line">    ...mapState([<span class="string">'address'</span>, <span class="string">'categorys'</span>]),</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    根据categorys一维数组生成一个2维数组</span></span><br><span class="line"><span class="comment">    小数组中的元素个数最大是8</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    categorysArr () &#123;</span><br><span class="line">      <span class="comment">// 1.先从当前组件中得到所有食品分类的一维数组</span></span><br><span class="line">      <span class="keyword">const</span> &#123;categorys&#125; = <span class="keyword">this</span></span><br><span class="line">      <span class="comment">// 2.准备一个空的二维数组--categorysArr</span></span><br><span class="line">      <span class="keyword">const</span> arr = []</span><br><span class="line">      <span class="comment">// 3.准备一个小数组--pages(最大长度为8)</span></span><br><span class="line">      <span class="keyword">let</span> minArr = []</span><br><span class="line">      <span class="comment">// 4.遍历categorys得到处理后的二维数组catagorysArr</span></span><br><span class="line">      categorys.forEach(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 如果当前小数组(pages)已经满了, 创建一个新的</span></span><br><span class="line">        <span class="keyword">if</span> (minArr.length === <span class="number">8</span>) &#123;</span><br><span class="line">          minArr = []</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果minArr是空的, 将小数组(pages)保存到大数组(categorysArr)中</span></span><br><span class="line">        <span class="keyword">if</span> (minArr.length === <span class="number">0</span>) &#123;</span><br><span class="line">          arr.push(minArr)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将当前分类信息保存到小数组(pages)中</span></span><br><span class="line">        minArr.push(data)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span> arr</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意第4步forEach里的逻辑顺序</p>
<p>1.为什么当minArr数组的长度为0时就将它与大数组关联起来，不是等它存满(8个)？</p>
<p>因为有可能categorys里的数据个数不为8的倍数，最后一个minArr内的数据不足8个。</p>
<p>2.为什么先判断minArr的长度为8的情况再判断等于0的情况？</p>
<p>因为先判断minArr的长度为0，将其放入大数组中与大数组关联起来，那么等到当前这个minArr填充完成之后新建的小数组则无法与大数组关联起来。</p>
<p>所以先判断长度为8的情况，再判断数组长度为0的情况。就可以确保之前的minArr填充完成后，新建的minArr都可以被放到大数组里与大数组关联起来。</p>
</blockquote>
<ul>
<li><p>除了上面的方式处理categorys，也可以采用分割数组的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">categorysArr () &#123;</span><br><span class="line">	<span class="keyword">const</span> &#123;categorys&#125; = <span class="keyword">this</span></span><br><span class="line">	<span class="keyword">const</span> arr = []</span><br><span class="line"> 	<span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>,len = categorys.length;i &lt; len; i += <span class="number">8</span>)&#123;</span><br><span class="line">    	arr.push(categorys.slice(i, i + <span class="number">8</span>))</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol start="4">
<li><p>将数据显示到页面上</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 因为食品分类的图片信息都有一个baseImageUrl所以在data里定义</span></span><br><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      baseImageUrl: <span class="string">'https://fuss10.elemecdn.com'</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--通过v-for循环渲染data的信息 注意src为绑定数据--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-slide"</span> <span class="attr">v-for</span>=<span class="string">"(pages,index) in categorysArr"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"javascript:"</span> <span class="attr">class</span>=<span class="string">"link_to_food"</span> <span class="attr">v-for</span>=<span class="string">"(data,index) in pages"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"food_container"</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">"baseImageUrl+data.image_url"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">span</span>&gt;</span>&#123;&#123;data.title&#125;&#125;<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用watch与-nextTick解决轮播的Bug"><a href="#使用watch与-nextTick解决轮播的Bug" class="headerlink" title="使用watch与$nextTick解决轮播的Bug"></a>使用watch与$nextTick解决轮播的Bug</h3><ul>
<li><p>分页器Swiper其实应该是在轮播列表显示(即categorys数组有了数据)以后才初始化。</p>
</li>
<li><p>最开始categorys为空数组，有了数据才会显示轮播列表，而要监视categorys的数据变化，就要用到<strong>watch</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建watch 监听categorys</span></span><br><span class="line">watch: &#123;</span><br><span class="line">    categorys (value) &#123; <span class="comment">// categorys数组中有数据了</span></span><br><span class="line">    	<span class="comment">// 但界面还没有异步更新</span></span><br><span class="line">    		<span class="keyword">new</span> Swiper(<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">          autoplay: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 如果需要分页器</span></span><br><span class="line">          pagination: &#123;</span><br><span class="line">            el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">            clickable: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">	&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 删除mounted中的new Swiper...代码</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>但其实<strong>state里的状态数据改变（categorys接收数据）与异步更新界面（显示轮播列表）是两个步骤</strong>。所以需要等一等，界面完成异步更新后才可以进行Swiper的初始化。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用setTimeout可以实现效果, 但是时机不准确</span></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个Swiper实例对象, 来实现轮播</span></span><br><span class="line">	<span class="keyword">new</span> Swiper(<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">          autoplay: <span class="literal">true</span>,</span><br><span class="line">          <span class="comment">// 如果需要分页器</span></span><br><span class="line">          pagination: &#123;</span><br><span class="line">            el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">            clickable: <span class="literal">true</span></span><br><span class="line">          &#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;, <span class="number">100</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用<code>vm.$nextTick( [callback] )</code>来实现等待界面完成异步更新就立即创建Swiper对象</p>
</li>
<li>nextTick将回调延迟到下次DOM更新循环之后执行</li>
<li><p>在修改数据之后立即使用它，然后等待DOM更新</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在修改数据之后立即使用它，然后等待 DOM 更新。</span></span><br><span class="line"><span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">// 一旦完成界面更新, 立即执行回调</span></span><br><span class="line">    <span class="keyword">new</span> Swiper(<span class="string">'.swiper-container'</span>, &#123;</span><br><span class="line">    	autoplay: <span class="literal">true</span>,</span><br><span class="line">    	pagination: &#123;</span><br><span class="line">    	el: <span class="string">'.swiper-pagination'</span>,</span><br><span class="line">    	clickable: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="异步显示商家列表"><a href="#异步显示商家列表" class="headerlink" title="异步显示商家列表"></a>异步显示商家列表</h3><ol>
<li><p>在Msite的mounted中获取异步数据</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$store.dispatch(<span class="string">'getShops'</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在ShopList.vue中引入mapState，在computed中读取状态数据</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">   <span class="keyword">import</span> &#123;mapState&#125; <span class="keyword">from</span> <span class="string">'vuex'</span></span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line"> 	computed: &#123;</span><br><span class="line">	...mapState([<span class="string">'shops'</span>])</span><br><span class="line">&#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改template并添加data</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   data () &#123;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">     baseImgUrl: <span class="string">'http://owoccema2.bkt.clouddn.com/show/MintShop/'</span></span><br><span class="line">   &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
 <figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">   <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"shop_li border-1px"</span> <span class="attr">v-for</span>=<span class="string">"(shop,index) in shops"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shop_left"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">"shop_img"</span> <span class="attr">:src</span>=<span class="string">"baseImgUrl + shop.image_path"</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    	<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"shop_right"</span>&gt;</span></span><br><span class="line">    		<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"shop_detail_header"</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">h4</span> <span class="attr">class</span>=<span class="string">"shop_title ellipsis"</span>&gt;</span>&#123;&#123;shop.name&#125;&#125;<span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span><br><span class="line">            	<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"shop_detail_ul"</span>&gt;</span></span><br><span class="line">               	...</span><br><span class="line">             	<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"shop_rating_order"</span>&gt;</span></span><br><span class="line">        	<span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"shop_rating_order_left"</span>&gt;</span></span><br><span class="line">       	 	...</span><br><span class="line">        	<span class="tag">&lt;/<span class="name">section</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="开发评分Star组件"><a href="#开发评分Star组件" class="headerlink" title="开发评分Star组件"></a>开发评分Star组件</h3><ul>
<li>不仅在首页的商家列表中有五颗星星的评分部分，商家信息的评价区域也有star评分，所以可以把它抽取成一个可复用的一般组件。</li>
</ul>
<ol>
<li><p>在components文件夹下新建Star文件夹，然后将原本在ShopList文件夹下的images文件夹里的stars移动到新建的Star文件夹里并重命名为images</p>
</li>
<li><p>在Star文件夹里新建Star.vue并将ShopList.vue中评分部分的模版和样式剪切进去，注意修改图片路径</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"star star-24"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item on"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item on"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item on"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item half"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item off"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>根据类名为组件设置属性props和计算属性</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类名常量</span></span><br><span class="line"><span class="keyword">const</span> CLASS_ON = <span class="string">'on'</span></span><br><span class="line"><span class="keyword">const</span> CLASS_HALF = <span class="string">'half'</span></span><br><span class="line"><span class="keyword">const</span> CLASS_OFF = <span class="string">'off'</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    score: <span class="built_in">Number</span>,</span><br><span class="line">    size: <span class="built_in">Number</span></span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    3.2: 3 + 0 + 2</span></span><br><span class="line"><span class="comment">    4.7: 4 + 1 + 0</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 该方法产生一个数组starArr来表示on half off类名的span数量（总长度为5）</span></span><br><span class="line">    starClasses () &#123;</span><br><span class="line">      <span class="keyword">const</span> &#123;score&#125; = <span class="keyword">this</span></span><br><span class="line">      <span class="keyword">const</span> starArr = []</span><br><span class="line">      <span class="comment">// 向starArr中添加n个CLASS_ON</span></span><br><span class="line">      <span class="keyword">const</span> scoreInteger = <span class="built_in">Math</span>.floor(score)</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; scoreInteger; i++) &#123;</span><br><span class="line">        starArr.push(CLASS_ON)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 向starArr中添加0/1个CLASS_HALF</span></span><br><span class="line">      <span class="keyword">if</span>(score*<span class="number">10</span>-scoreInteger*<span class="number">10</span>&gt;=<span class="number">5</span>) &#123;</span><br><span class="line">        starArr.push(CLASS_HALF)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// 向starArr中添加n个CLASS_OFF</span></span><br><span class="line">      <span class="keyword">while</span>(starArr.length&lt;<span class="number">5</span>) &#123;</span><br><span class="line">        starArr.push(CLASS_OFF)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> starArr</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改template模版</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"star"</span> <span class="attr">:class</span>=<span class="string">"'star-'+size"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"star-item"</span> <span class="attr">v-for</span>=<span class="string">"(sc, index) in starClasses"</span> <span class="attr">:class</span>=<span class="string">"sc"</span> <span class="attr">:key</span>=<span class="string">"index"</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在ShopList中import引入并注册使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Star</span> <span class="attr">:score</span>=<span class="string">"shop.rating"</span> <span class="attr">:size</span>=<span class="string">"24"</span>&gt;</span><span class="tag">&lt;/<span class="name">Star</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用svg显示页面加载中提示界面"><a href="#使用svg显示页面加载中提示界面" class="headerlink" title="使用svg显示页面加载中提示界面"></a>使用svg显示页面加载中提示界面</h3><ul>
<li><p>目前首页的内容数据已经可以异步获取并显示，但在数据还未加载完成时，为了优化用户体验，应该给出页面加载中的提示界面。</p>
</li>
<li><p>首先将svg资源图片放入相应的Msite和ShopList的images文件夹里</p>
</li>
<li><p>然后修改模版的显示条件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--Msite--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"swiper-container"</span> <span class="attr">v-if</span>=<span class="string">"categorys.length"</span>&gt;</span></span><br><span class="line">	...</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">//没有数据的时候显示图片</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./images/msite_back.svg"</span> <span class="attr">alt</span>=<span class="string">"back"</span> <span class="attr">v-else</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--ShopList--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"shop_list"</span> <span class="attr">v-if</span>=<span class="string">"shops.length"</span>&gt;</span></span><br><span class="line">    ...</span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 循环显示6个svg图片 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-else</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"item in 6"</span> <span class="attr">:key</span>=<span class="string">"item"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./images/shop_back.svg"</span> <span class="attr">alt</span>=<span class="string">"back"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

        
        <br />
        <div id="comment-container">
        </div>
        <div id="disqus_thread"></div>
    </div>
</div>
    </div>
</div>


<!--<footer class="footer">-->
    <!--<ul class="list-inline text-center">-->
        <!---->
        <!---->

        <!---->

        <!---->

        <!---->

        <!---->

    <!--</ul>-->
    <!---->
    <!--<p>-->
        <!--<span id="busuanzi_container_site_pv">-->
            <!--<span id="busuanzi_value_site_pv"></span>PV-->
        <!--</span>-->
        <!--<span id="busuanzi_container_site_uv">-->
            <!--<span id="busuanzi_value_site_uv"></span>UV-->
        <!--</span>-->
        <!--Created By <a href="https://hexo.io/">Hexo</a>  Theme <a href="https://github.com/aircloud/hexo-theme-aircloud">AirCloud</a></p>-->
<!--</footer>-->




</body>

<script>
    // We expose some of the variables needed by the front end
    window.hexo_search_path = "search.xml"
    window.hexo_root = "/"
    window.isPost = true
</script>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="/js/index.js"></script>
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


</html>
